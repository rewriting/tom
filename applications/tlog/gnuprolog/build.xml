<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- NovoSoft UML API for Java build file                                    -->
<!-- ======================================================================= -->

<project name="gnuprolog" default="main" basedir=".">

  <target name="init">
    <property name="Name" value="GNU Prolog for Java"/>
    <property name="name" value="gnuprolog"/>
    <property name="version" value="0.1.0"/>
    <property name="_version" value="0_1_0"/>

    <property name="debug" value="on"/>

    <property name="src.dir" value="${basedir}/src"/>
    <property name="docs.dir" value="${basedir}/docs"/>
    <property name="lib.dir" value="${basedir}/lib"/>
    <property name="build.dir" value="${basedir}/build"/>
    <property name="package.dir" value="${build.dir}/${name}"/>
    <property name="classes" value="${build.dir}/classes"/>
    <property name="classpath" value=""/>
    <property name="manifest" value="manifest.mf"/>
    <!-- <property name="build.compiler" value="jikes"/> -->

  </target>

  <!-- =================================================================== -->
  <!-- Main                                                                -->
  <!-- =================================================================== -->
  <target name="main" depends="build">
  </target>


  <target name="build" depends="jar">
  </target>

  <target name="package" depends="zip">
  </target>

  <target name="zip" depends="complete_zip">
  </target>

  <target name="src_zip" depends="copy_src">
    <zip zipfile="${build.dir}/${name}-src-${_version}.zip" basedir="${build.dir}" includes="${name}/**/*">
    </zip> 
  </target>

  <target name="copy_src" depends="jar,javadoc">
    <delete dir="${package.dir}"/>
    <copy todir="${package.dir}/src"> 
      <fileset dir="${src.dir}"/>
    </copy>
    <copy todir="${package.dir}/docs">
      <fileset dir="${docs.dir}"/>
    </copy>
    <copy file="${manifest}" todir="${package.dir}"/>
    <copy file="${basedir}/build.xml" todir="${package.dir}"/>
    <copy file="${basedir}/package-list" todir="${package.dir}"/>
  </target>

  <target name="copy_complete" depends="src_zip">
    <copy todir="${package.dir}/docs/api">
      <fileset dir="${build.dir}/api"/>
    </copy>
    <copy file="${build.dir}/${name}.jar" todir="${package.dir}"/>
  </target>

  <target name="complete_zip" depends="copy_complete">
    <zip zipfile="${build.dir}/${name}-complete-${_version}.zip" basedir="${build.dir}" includes="${name}/**/*">
    </zip> 
  </target>


  <target name="javadoc" depends="init">
    <delete dir="${build.dir}/api"/>
    <mkdir dir="${build.dir}/api"/>
    <javadoc private="true"
             destdir="${build.dir}/api"
             packageList="${basedir}/package-list"
             sourcepath="${src.dir}"
             author="true"
             use="true"
             header="&lt;a href='http://gnuprologjava.sourceforge.net'&gt; GNU Prolog for Java &lt;/a&gt;"
             footer="&lt;a href='http://gnuprologjava.sourceforge.net'&gt; GNU Prolog for Java &lt;/a&gt;"
    />
  </target>

  <target name="jar" depends="compile">
    <delete file="${build.dir}/${name}.jar"/>
    <filter token="version" value="${version}"/>
    <copy file="${manifest}"
          tofile="${classes}/${manifest}"
          filtering="on"
    />
    <copy file="${src.dir}/gnu/prolog/vm/buildins/buildins.pro"
          tofile="${classes}/gnu/prolog/vm/buildins/buildins.pro"
          filtering="off"
    />
    <jar jarfile="${build.dir}/${name}.jar"
         basedir="${classes}"
         excludes="${manifest}"
         manifest="${classes}/${manifest}"
    />
  </target>

  <target name="compile" depends="init">
    <mkdir dir="${classes}"/>
    <javac srcdir="${src.dir}"
           destdir="${classes}"
           debug="${debug}"
           deprecation="off"
           optimize="on"
    />
  </target>

  <target name="site" depends="javadoc">
    <delete dir="${build.dir}/site"/>
    <mkdir dir="${build.dir}/site"/>
    <copy todir="${build.dir}/site" filter="on">
      <fileset dir="${basedir}"/>
    </copy>
  </target>


  <!-- =================================================================== -->
  <!-- Cleans up generated stuff                                           -->
  <!-- =================================================================== -->
  <target name="clean" depends="init">
    <delete dir="${build.dir}"/>
    <!-- <delete dir="${docs.dir}/api"/> -->
  </target>

</project>

